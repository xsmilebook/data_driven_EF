# 2026-01-05 会话记录

## 变更目的
补充 task-fMRI 的 xcp-d（`xcpd-0.7.1rc5`）处理流程文档，形成可直接复现的工程说明与参数口径记录。

## 修改内容
- 新增流程说明文档：`docs/reports/task_fmri_xcpd_pipeline.md`（详细描述 task regressors 的构建、xcp-d 参数与常见报错处理）。
- 更新 SST 的 block/state 回归量提取逻辑：兼容 120 试次（单 block）与 180 试次（双 block，90/91 之间注视间隔），并在存在 `Trial_loop_list` 时优先使用 loop1/loop2 识别 block。
- 将 xcp-d 容器升级到 `xcp_d-0.10.0`，并按官方 CLI 模式改为 `--datasets custom=...` + YAML confounds 配置注入 task regressors；同时增加 FreeSurfer subjects dir 的 bind（`SUBJECTS_DIR=/freesurfer`）。
- 保持 xcp-d 参数配置尽量精简（不显式设置 `output-type`/censoring 等），本次变更重点为容器路径与 bind mounts（fMRIPrep、FreeSurfer、TemplateFlow、自定义 task confounds）。
- 新增写死路径、可直接分享运行的 task-fMRI xcp-d 直接脚本：
  - 单被试单任务：`temp/run_xcpd_task_direct.sh`
  - 批量提交：`temp/batch_run_xcpd_task_direct.sh`
- 在 `docs/workflow.md` 与 `docs/reports/task_fmri_xcpd_pipeline.md` 补充上述“直接脚本”入口说明。
